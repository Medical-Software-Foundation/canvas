{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://canvas.medical/schemas/intake_session.json",
  "title": "Intake Session",
  "description": "Schema for patient intake chat session data stored in Canvas SDK cache",
  "type": "object",
  "required": [
    "session_id",
    "created_at",
    "updated_at",
    "messages",
    "collected_data",
    "status"
  ],
  "properties": {
    "session_id": {
      "type": "string",
      "description": "Unique identifier for the session (32-character hexadecimal string)",
      "pattern": "^[a-f0-9]{32}$"
    },
    "created_at": {
      "type": "string",
      "description": "ISO 8601 timestamp when session was created",
      "format": "date-time"
    },
    "updated_at": {
      "type": "string",
      "description": "ISO 8601 timestamp when session was last updated",
      "format": "date-time"
    },
    "messages": {
      "type": "array",
      "description": "Conversation messages between agent and patient",
      "items": {
        "type": "object",
        "required": ["role", "content", "timestamp"],
        "properties": {
          "role": {
            "type": "string",
            "description": "Message sender role",
            "enum": ["agent", "user"]
          },
          "content": {
            "type": "string",
            "description": "Message content text",
            "minLength": 1
          },
          "timestamp": {
            "type": "string",
            "description": "ISO 8601 timestamp when message was sent",
            "format": "date-time"
          }
        },
        "additionalProperties": false
      }
    },
    "collected_data": {
      "type": "object",
      "description": "Patient information collected during intake",
      "required": [
        "first_name",
        "last_name",
        "email",
        "phone",
        "date_of_birth",
        "reason_for_visit"
      ],
      "properties": {
        "first_name": {
          "type": ["string", "null"],
          "description": "Patient's first name",
          "minLength": 1
        },
        "last_name": {
          "type": ["string", "null"],
          "description": "Patient's last name",
          "minLength": 1
        },
        "email": {
          "type": ["string", "null"],
          "description": "Patient's email address",
          "format": "email"
        },
        "phone": {
          "type": ["string", "null"],
          "description": "Patient's phone number (any format)",
          "minLength": 1
        },
        "date_of_birth": {
          "type": ["string", "null"],
          "description": "Patient's date of birth in YYYY-MM-DD format",
          "pattern": "^\\d{4}-\\d{2}-\\d{2}$"
        },
        "reason_for_visit": {
          "type": ["string", "null"],
          "description": "Brief description of why patient is seeking care",
          "minLength": 1
        }
      },
      "additionalProperties": false
    },
    "status": {
      "type": "string",
      "description": "Current status of the intake session",
      "enum": ["active", "completed", "abandoned"]
    },
    "phone_verification_code": {
      "type": ["string", "null"],
      "description": "6-digit verification code sent to patient's phone",
      "pattern": "^\\d{6}$"
    },
    "phone_verified": {
      "type": "boolean",
      "description": "Whether the phone number has been successfully verified",
      "default": false
    },
    "patient_record_status": {
      "type": ["integer", "null"],
      "description": "Status of patient record creation: 1=not_started, 2=pending, 3=complete",
      "enum": [1, 2, 3, null]
    }
  },
  "additionalProperties": false
}
